<!DOCTYPE html>
<html>
<head>
    <title>Chess Game</title>
    <!-- In board.html, add this at the top -->
<div class="game-info">
    <div class="status-bar">
        <span class="mode-badge">{{ game_mode|upper }}</span>
        <span class="turn-indicator {% if turn == 'WHITE' %}white-turn{% else %}black-turn{% endif %}">
            Turn: {{ turn }}
            {% if game_mode == 'ai' and turn == 'BLACK' %}
                <span class="ai-thinking">ðŸ¤– AI thinking...</span>
            {% endif %}
        </span>
        
        {% if checkmate %}
            <span class="checkmate-alert">CHECKMATE! {{ winner }} wins!</span>
        {% elif check_king_pos %}
            <span class="check-alert">CHECK!</span>
        {% endif %}
    </div>
    
    <div class="move-history">
        <h4>Move History:</h4>
        <div class="history-list">
            {% for move in move_history|slice:"-10:" %}  <!-- Last 10 moves -->
                <div class="move-entry">{{ move }}</div>
            {% empty %}
                <div class="no-moves">No moves yet</div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
.game-info {
    margin: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #dee2e6;
}

.status-bar {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
}

.mode-badge {
    background: #6c757d;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 14px;
}

.turn-indicator {
    padding: 5px 10px;
    border-radius: 4px;
    font-weight: bold;
}

.white-turn {
    background: #fff;
    color: #000;
    border: 2px solid #000;
}

.black-turn {
    background: #000;
    color: #fff;
    border: 2px solid #fff;
}

.ai-thinking {
    color: #007bff;
    margin-left: 10px;
}

.checkmate-alert {
    background: #dc3545;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    animation: pulse 1s infinite;
}

.check-alert {
    background: #ffc107;
    color: #000;
    padding: 5px 10px;
    border-radius: 4px;
    font-weight: bold;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

.move-history {
    max-height: 200px;
    overflow-y: auto;
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.move-entry {
    padding: 5px;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 3px;
    font-family: monospace;
}

.no-moves {
    color: #6c757d;
    font-style: italic;
}
</style>
    <style>
    body {
        display: flex;
        justify-content: center;
        margin-top: 40px;
        font-family: Arial, sans-serif;
    }

    .board {
        display: grid;
        grid-template-columns: repeat(8, 60px);
        grid-template-rows: repeat(8, 60px);
        border: 4px solid black;
    }
    .king-check {
        box-shadow: inset 0 0 0 4px red;
    }


    form {
        margin: 0;
        padding: 0;
    }

    button.square {
        width: 60px;
        height: 60px;
        font-size: 32px;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .white {
        background-color: #f0d9b5;
    }

    .black {
        background-color: #b58863;
    }

    button.square:hover {
        outline: 2px solid red;
    }
    .selected {
        outline: 4px solid red;
    }
    .legal {
        box-shadow: inset 0 0 0 4px green;
    }


</style>

</head>
<body>
<div style="display:flex; gap:30px; align-items:flex-start;">

    <!-- LEFT PANEL -->
<div style="width:200px;">
    <h3>Turn: {{ turn }}</h3>

    {% if error %}
        <p style="color:red;">{{ error }}</p>
    {% endif %}

    {% if checkmate %}
        <h2 style="color:red;">
            {% if resigned %}
                Game Resigned
            {% else %}
                CHECKMATE
            {% endif %}
        </h2>

        <p>{{ winner }} wins</p>

        <form method="post">
            {% csrf_token %}
            <button name="restart" type="submit">
                Restart Game
            </button>
        </form>
    {% endif %}
<hr>
<h3>Move History</h3>

<div style="max-height:300px; overflow-y:auto; font-size:14px;">
    {% for move in move_history %}
        <div>{{ forloop.counter }}. {{ move }}</div>
    {% empty %}
        <div>No moves yet</div>
    {% endfor %}
</div>

</div>
{% if promotion %}
<div style="margin-bottom:20px; text-align:center;">
    <h3>Choose Promotion</h3>
    <form method="post">
        {% csrf_token %}
        <button name="promote_to" value="Q">Queen</button>
        <button name="promote_to" value="R">Rook</button>
        <button name="promote_to" value="B">Bishop</button>
        <button name="promote_to" value="N">Knight</button>
    </form>
</div>
{% endif %}
    <!-- GAME MODE SELECTION -->
{% if not request.session.game_mode %}
<form method="post">
    {% csrf_token %}
    <button name="mode" value="human">Human vs Human</button>
    <button name="mode" value="ai">Human vs AI</button>
</form>
{% endif %}

    <!-- CHESS BOARD -->
<form method="post">
{% csrf_token %}

<div class="board">
    {% for row in board %}
        {% for square in row %}
           <button
                name="square"
                value="{{ square.row }},{{ square.col }}"
                class="square {{ square.color }}
                    {% if square.selected %}selected{% endif %}
                    {% if square.king_in_check %}king-check{% endif %}"
                type="submit"
            >
                {{ square.piece }}
            </button>
        {% endfor %}
    {% endfor %}
</div>
</form>
<form method="post">
    {% csrf_token %}
    <button name="resign" type="submit" style="background:red; color:white; padding:8px;">
        Resign Game
    </button>
</form>




</body>
</html>
